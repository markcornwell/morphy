Type.registerNamespace("Lighthouse1.Apps.Web.CustomServerControls");Lighthouse1.Apps.Web.CustomServerControls.PDFViewer=function(n){if(typeof jQuery=="undefined")throw"Lighthouse1.Apps.Web.CustomServerControls.PDFViewer requires jQuery library to be included on the page";Lighthouse1.Apps.Web.CustomServerControls.PDFViewer.initializeBase(this,[n]);this._defaultDevicePixelRatio=null;this._previousDevicePixelRatio=null;this._scrollDelta=5;this._pnlPages=null;this._pnlPagesId=null;this._pnlLoader=null;this._pnlLoaderId=null;this._btnSave=null;this._btnSaveId=null;this._btnPrint=null;this._btnPrintId=null;this._saveFileUrl=null;this._printFileUrl=null;this._deleteFileFromCacheUrl=null;this._totalPages=null;this._disposeFileOnClient=null;this._isPrintLocked=!1};Lighthouse1.Apps.Web.CustomServerControls.PDFViewer.prototype={initialize:function(){var n=this;Lighthouse1.Apps.Web.CustomServerControls.PDFViewer.callBaseMethod(n,"initialize");n._defaultDevicePixelRatio=window.devicePixelRatio;n._previousDevicePixelRatio=window.devicePixelRatio;n._pnlPages=$get(n._pnlPagesId);n._pnlLoader=$get(n._pnlLoaderId);n._btnSave=$get(n._btnSaveId);n._btnPrint=$get(n._btnPrintId);$(window).on("load",function(){n._windowOnLoad()});$(window).on("resize",function(){n._windowOnResize()});$(n._pnlPages).on("scroll",function(){n._pnlPagesOnScroll()});$(n._btnSave).on("click",function(t){n._btnSaveOnClick(t)});$(n._btnPrint).on("click",function(t){n._btnPrintOnClick(t)});n.add_documentZoomChange(n._documentOnZoomChange)},get_pnlPagesId:function(){return this._pnlPagesId},set_pnlPagesId:function(n){this._pnlPagesId!==n&&(this._pnlPagesId=n,this.raisePropertyChanged("pnlPagesId"))},get_pnlLoaderId:function(){return this._pnlLoaderId},set_pnlLoaderId:function(n){this._pnlLoaderId!==n&&(this._pnlLoaderId=n,this.raisePropertyChanged("pnlLoaderId"))},get_btnSaveId:function(){return this._btnSaveId},set_btnSaveId:function(n){this._btnSaveId!==n&&(this._btnSaveId=n,this.raisePropertyChanged("btnSaveId"))},get_btnPrintId:function(){return this._btnPrintId},set_btnPrintId:function(n){this._btnPrintId!==n&&(this._btnPrintId=n,this.raisePropertyChanged("btnPrintId"))},get_saveFileUrl:function(){return this._saveFileUrl},set_saveFileUrl:function(n){this._saveFileUrl!==n&&(this._saveFileUrl=n,this.raisePropertyChanged("saveFileUrl"))},get_printFileUrl:function(){return this._printFileUrl},set_printFileUrl:function(n){this._printFileUrl!==n&&(this._printFileUrl=n,this.raisePropertyChanged("printFileUrl"))},get_deleteFileFromCacheUrl:function(){return this._deleteFileFromCacheUrl},set_deleteFileFromCacheUrl:function(n){this._deleteFileFromCacheUrl!==n&&(this._deleteFileFromCacheUrl=n,this.raisePropertyChanged("deleteFileFromCacheUrl"))},get_totalPages:function(){return this._totalPages},set_totalPages:function(n){this._totalPages!==n&&(this._totalPages=n,this.raisePropertyChanged("totalPages"))},get_disposeFileOnClient:function(){return this._disposeFileOnClient},set_disposeFileOnClient:function(n){this._disposeFileOnClient!==n&&(this._disposeFileOnClient=n,this.raisePropertyChanged("disposeFileOnClient"))},add_documentLoad:function(n){this.get_events().addHandler("documentLoad",n)},remove_documentLoad:function(n){this.get_events().removeHandler("documentLoad",n)},add_documentZoomChange:function(n){this.get_events().addHandler("documentZoomChange",n)},remove_documentZoomChange:function(n){this.get_events().removeHandler("documentZoomChange",n)},add_documentScrollEnd:function(n){this.get_events().addHandler("documentScrollEnd",n)},remove_documentScrollEnd:function(n){this.get_events().removeHandler("documentScrollEnd",n)},getPages:function(){return $(".pdf-viewer__page")},getPageImages:function(){return $(".pdf-viewer__page-image")},save:function(){var n=this,t;n._totalPages>0&&(t=$('<iframe src="'+n._saveFileUrl+'" style="display: none;"><\/iframe>'),$("body").append(t))},print:function(){var n=this,t,i;if(n._totalPages>0&&!n._isPrintLocked){n._isPrintLocked=!0;t=$(n._pnlLoader);i=$('<iframe src="'+n._printFileUrl+'" style="display: none;"><\/iframe>');t.show();i.on("load",function(){t.hide();n._isPrintLocked=!1});$("body").append(i)}},deleteFileFromCache:function(){var n=this;$.post(n._deleteFileFromCacheUrl)},isDocumentLoaded:function(){var t=this,n=!0,i=t.getPageImages();return i.length===t._totalPages&&i.each(function(){return n=this.complete,n?void 0:!1}),n},isDocumentZoomChanged:function(){var n=this;return window.devicePixelRatio!==n._previousDevicePixelRatio},isDocumentScrolledToEnd:function(){var n=this,t=n._pnlPages.scrollTop,i=n._pnlPages.clientHeight,r=n._pnlPages.scrollHeight;return t+i+n._scrollDelta>=r},_loadPages:function(){function t(t,i){i.removeClass("pdf-viewer__page_status_loading");t.removeClass("pdf-viewer__page-image_status_loading");n.isDocumentLoaded()&&n._raiseEvent("documentLoad")}var n=this,i=n.getPages();i.each(function(){var n=$(this),r=n.attr("data-page-image-url"),i=$('<img class="pdf-viewer__page-image pdf-viewer__page-image_status_loading" src="'+r+'" />').appendTo(n);if(i[0].complete)t(i,n);else i.on("load",function(){var i=$(this);t(i,n)})})},_windowOnLoad:function(){var n=this;n._loadPages()},_windowOnResize:function(){var n=this;n.isDocumentZoomChanged()&&n._raiseEvent("documentZoomChange")},_pnlPagesOnScroll:function(){var n=this;n.isDocumentScrolledToEnd()&&n._raiseEvent("documentScrollEnd")},_btnSaveOnClick:function(n){var t=this;n.preventDefault();t.save()},_btnPrintOnClick:function(n){var t=this;n.preventDefault();t.print()},_documentOnZoomChange:function(n){var i=n,u=i.getPageImages(),t=100,r=window.devicePixelRatio;i._previousDevicePixelRatio=r;t=r/i._defaultDevicePixelRatio*100;t=Math.round(t);u.css("max-width",t+"%")},_raiseEvent:function(n){var t=this,i=t.get_events().getHandler(n),arguments;i&&(arguments=Sys.EventArgs.Empty,i(t,arguments))},dispose:function(){var n=this,t=n.get_element();n._disposeFileOnClient&&n.deleteFileFromCache();$clearHandlers(t);Lighthouse1.Apps.Web.CustomServerControls.PDFViewer.callBaseMethod(n,"dispose")}};Lighthouse1.Apps.Web.CustomServerControls.PDFViewer.registerClass("Lighthouse1.Apps.Web.CustomServerControls.PDFViewer",Sys.UI.Control);typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();